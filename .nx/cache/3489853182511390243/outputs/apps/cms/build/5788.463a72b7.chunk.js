"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[5788,9001],{15788:(Q,h,s)=>{s.d(h,{ProtectedCreateView:()=>Y});var _=s(91320),I=s(6264),R=s(5676),B=s(79377),K=s(99001),j=s(38239),x=s(54769),S=s(98297),l=s(69158),p=s(51896),u=s(85904),n=s(70644),N=s(39112),f=s(32805),V=s(84770),U=s(67652),F=s(13768),c=s(99321),W=s(90217),M=s(76350),y=s(22310),Z=s(96110),T=s(76251),d=s(21977),X=s(49470),k=s(17141),w=s(21681),b=s(38506),q=s(99135),ss=s(52800),_s=s(62643),ts=s(2863),ns=s(4626),as=s(50589),Es=s(77315),os=s(89775),es=s(56302),rs=s(75376),is=s(50024),ds=s(92585),Ms=s(64706),Ps=s(98064),Ds=s(87282),Os=s(10112),ls=s(13406),Ts=s(35577),ms=s(73607),vs=s(38243),As=s(23889),Ls=s(18334),Cs=s(7405),Is=s(74261);const Y=()=>{const $=(0,R.v9)(B.s);return(0,_.jsx)(I.O4,{permissions:$.settings?.["transfer-tokens"].create,children:(0,_.jsx)(K.N,{})})}},99001:(Q,h,s)=>{s.d(h,{N:()=>z,ProtectedEditView:()=>Ks});var _=s(91320),I=s(38239),R=s(20674),B=s(44137),K=s(65676),j=s(92422),x=s(70946),S=s(2548),l=s(64150),p=s(64062),u=s(70269),n=s(6264),N=s(84749),f=s(58686),V=s(13768),U=s(67645),F=s(54769),c=s(5676),W=s(71179),M=s(90217),y=s(79377),Z=s(6814),T=s(73047),d=s(74261),X=s(98297),k=s(69158),w=s(51896),b=s(85904),q=s(70644),ss=s(39112),_s=s(32805),ts=s(84770),ns=s(67652),as=s(99321),Es=s(76350),os=s(22310),es=s(96110),rs=s(76251),is=s(21977),ds=s(49470),Ms=s(17141),Ps=s(21681),Ds=s(38506),Os=s(99135),ls=s(52800),Ts=s(62643),ms=s(2863),vs=s(4626),As=s(50589),Ls=s(77315),Cs=s(89775),Is=s(56302),Y=s(75376),$=s(50024),Vs=s(92585),Fs=s(64706),Zs=s(98064),Ys=s(87282),$s=s(10112),zs=s(13406),Gs=s(35577),Hs=s(73607),Js=s(38243),Qs=s(23889),Xs=s(18334),ks=s(7405);const Rs=M.Ry().shape({name:M.Z_().max(100).required(n.I0.required),description:M.Z_().nullable(),lifespan:M.Rx().integer().min(0).nullable().defined(n.I0.required),permissions:M.Z_().required(n.I0.required)}),Bs="Name already taken",z=()=>{(0,n.go)();const{formatMessage:e}=(0,U.Z)(),{lockApp:i,unlockApp:P}=(0,n.o1)(),r=(0,n.lm)(),D=(0,W.k6)(),{state:m}=(0,W.TH)(),[E,v]=I.useState(m&&"accessKey"in m.transferToken?{...m.transferToken}:null),{trackUsage:O}=(0,n.rS)(),{setCurrentStep:Ws}=(0,n.c1)(),gs=(0,c.v9)(y.s),{allowedActions:{canCreate:hs,canUpdate:cs,canRegenerate:ys}}=(0,n.ss)(gs.settings["transfer-tokens"]),js=(0,W.$B)("/settings/transfer-tokens/:id"),{get:xs,post:Ss,put:ps}=(0,n.kY)(),g=js?.params?.id,o=g==="create",{formatAPIError:G}=(0,n.So)();I.useEffect(()=>{O(o?"didAddTokenFromList":"didEditTokenFromList",{tokenType:T.T})},[o,O]),(0,F.useQuery)(["transfer-token",g],async()=>{const{data:{data:t}}=await xs(`/admin/transfer/tokens/${g}`);return v({...t}),t},{enabled:!o&&!E,onError(t){t instanceof f.d7&&(t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?r({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):r({type:"warning",message:G(t)}))}});const us=async(t,A)=>{O(o?"willCreateToken":"willEditToken",{tokenType:T.T}),i();const L=t.permissions.split("-");if((a=>a.length===1?a[0]==="push"||a[0]==="pull":a[0]==="push"&&a[1]==="pull")(L))try{let a;if(o){const{data:C}=await Ss("/admin/transfer/tokens",{...t,permissions:L});a=C.data}else{const{data:C}=await ps(`/admin/transfer/tokens/${g}`,{name:t.name,description:t.description,permissions:L});a=C.data}P(),o&&(D.replace(`/settings/transfer-tokens/${a.id}`,{transferToken:a}),Ws("transferTokens.success")),v({...a}),r({type:"success",message:e(o?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),O(o?"didCreateToken":"didEditToken",{type:E?.permissions,tokenType:T.T})}catch(a){if(a instanceof f.d7){const C=(0,Z.f)(a.response.data);A.setErrors(C),a?.response?.data?.error?.message===Bs?r({type:"warning",message:a.response.data.message||"notification.error.tokennamenotunique"}):a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?r({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):r({type:"warning",message:a?.response?.data?.message||"notification.error"})}P()}},H=cs&&!o||hs&&o;if(!o&&!E)return(0,_.jsx)(Us,{});const Ns=t=>{t instanceof f.d7&&(t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?r({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):r({type:"warning",message:G(t)}))};return(0,_.jsxs)(R.o,{children:[(0,_.jsx)(n.SL,{name:"Transfer Tokens"}),(0,_.jsx)(V.J9,{validationSchema:Rs,validateOnChange:!1,initialValues:{name:E?.name||"",description:E?.description||"",lifespan:E?.lifespan??null,permissions:E?.permissions.join("-")??""},enableReinitialize:!0,onSubmit:(t,A)=>us(t,A),children:({errors:t,handleChange:A,isSubmitting:L,values:J})=>(0,_.jsxs)(n.l0,{children:[(0,_.jsx)(d.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"TokenCreate Transfer Token"},token:E,setToken:v,canEditInputs:H,canRegenerate:ys,isSubmitting:L,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:Ns}),(0,_.jsx)(B.D,{children:(0,_.jsxs)(K.k,{direction:"column",alignItems:"stretch",gap:6,children:[E&&Boolean(E?.name)&&"accessKey"in E&&(0,_.jsx)(d.c,{token:E.accessKey,tokenType:T.T}),(0,_.jsx)(fs,{errors:t,onChange:A,canEditInputs:H,isCreating:o,values:J,transferToken:E})]})})]})})]})},Ks=()=>{const e=(0,c.v9)(y.s);return(0,_.jsx)(n.O4,{permissions:e.settings?.["transfer-tokens"].read,children:(0,_.jsx)(z,{})})},fs=({errors:e={},onChange:i,canEditInputs:P,isCreating:r,values:D,transferToken:m={}})=>{const{formatMessage:E}=(0,U.Z)(),v=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,_.jsx)(j.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,_.jsxs)(K.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,_.jsx)(x.Z,{variant:"delta",as:"h2",children:E({id:"global.details",defaultMessage:"Details"})}),(0,_.jsxs)(S.r,{gap:5,children:[(0,_.jsx)(l.P,{col:6,xs:12,children:(0,_.jsx)(d.T,{error:e.name,value:D.name,canEditInputs:P,onChange:i})},"name"),(0,_.jsx)(l.P,{col:6,xs:12,children:(0,_.jsx)(d.a,{error:e.description,value:D.description,canEditInputs:P,onChange:i})},"description"),(0,_.jsx)(l.P,{col:6,xs:12,children:(0,_.jsx)(d.L,{isCreating:r,error:e.lifespan,value:D.lifespan,onChange:i,token:m})},"lifespan"),(0,_.jsx)(l.P,{col:6,xs:12,children:(0,_.jsx)(d.b,{name:"permissions",value:D.permissions,error:e.permissions,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:O=>{i({target:{name:"permissions",value:O}})},options:v,canEditInputs:P})},"permissions")]})]})})},Us=({transferTokenName:e})=>{const{formatMessage:i}=(0,U.Z)();return(0,n.go)(),(0,_.jsxs)(R.o,{"aria-busy":"true",children:[(0,_.jsx)(n.SL,{name:"Transfer Tokens"}),(0,_.jsx)(p.T,{primaryAction:(0,_.jsx)(u.z,{disabled:!0,startIcon:(0,_.jsx)(N.Z,{}),type:"button",size:"L",children:i({id:"global.save",defaultMessage:"Save"})}),title:e||i({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,_.jsx)(B.D,{children:(0,_.jsx)(n.dO,{})})]})}}}]);
