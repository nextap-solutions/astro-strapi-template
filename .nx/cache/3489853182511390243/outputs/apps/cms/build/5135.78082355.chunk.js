(self.webpackChunkcms=self.webpackChunkcms||[]).push([[5135],{47363:(M,T,s)=>{var e=s(88595),d=s(65438),n=s(73004),u=s(5316),l=s(39788),h=s(92793),c=200;function p(O,_,j,D){var k=-1,K=d,Z=!0,C=O.length,B=[],V=_.length;if(!C)return B;j&&(_=u(_,l(j))),D?(K=n,Z=!1):_.length>=c&&(K=h,Z=!1,_=new e(_));e:for(;++k<C;){var b=O[k],S=j==null?b:j(b);if(b=D||b!==0?b:0,Z&&S===S){for(var H=V;H--;)if(_[H]===S)continue e;B.push(b)}else K(_,S,D)||B.push(b)}return B}M.exports=p},91110:(M,T,s)=>{var e=s(65017),d=s(27829),n=d(e);M.exports=n},1191:(M,T,s)=>{var e=s(91110),d=s(91514);function n(u,l){var h=-1,c=d(u)?Array(u.length):[];return e(u,function(p,O,_){c[++h]=l(p,O,_)}),c}M.exports=n},23761:(M,T,s)=>{var e=s(5316),d=s(26693),n=s(67008),u=s(1191),l=s(72435),h=s(39788),c=s(23409),p=s(96036),O=s(7405);function _(j,D,k){D.length?D=e(D,function(C){return O(C)?function(B){return d(B,C.length===1?C[0]:C)}:C}):D=[p];var K=-1;D=e(D,h(n));var Z=u(j,function(C,B,V){var b=e(D,function(S){return S(C)});return{criteria:b,index:++K,value:C}});return l(Z,function(C,B){return c(C,B,k)})}M.exports=_},72435:M=>{function T(s,e){var d=s.length;for(s.sort(e);d--;)s[d]=s[d].value;return s}M.exports=T},43822:(M,T,s)=>{var e=s(52416);function d(n,u){if(n!==u){var l=n!==void 0,h=n===null,c=n===n,p=e(n),O=u!==void 0,_=u===null,j=u===u,D=e(u);if(!_&&!D&&!p&&n>u||p&&O&&j&&!_&&!D||h&&O&&j||!l&&j||!c)return 1;if(!h&&!p&&!D&&n<u||D&&l&&c&&!h&&!p||_&&l&&c||!O&&c||!j)return-1}return 0}M.exports=d},23409:(M,T,s)=>{var e=s(43822);function d(n,u,l){for(var h=-1,c=n.criteria,p=u.criteria,O=c.length,_=l.length;++h<O;){var j=e(c[h],p[h]);if(j){if(h>=_)return j;var D=l[h];return j*(D=="desc"?-1:1)}}return n.index-u.index}M.exports=d},27829:(M,T,s)=>{var e=s(91514);function d(n,u){return function(l,h){if(l==null)return l;if(!e(l))return n(l,h);for(var c=l.length,p=u?c:-1,O=Object(l);(u?p--:++p<c)&&h(O[p],p,O)!==!1;);return l}}M.exports=d},78181:(M,T,s)=>{var e=s(5316),d=s(67008),n=s(1191),u=s(7405);function l(h,c){var p=u(h)?e:n;return p(h,d(c,3))}M.exports=l},13779:(M,T,s)=>{var e=s(35825),d=s(23761),n=s(39416),u=s(78195),l=n(function(h,c){if(h==null)return[];var p=c.length;return p>1&&u(h,c[0],c[1])?c=[]:p>2&&u(c[0],c[1],c[2])&&(c=[c[0]]),d(h,e(c,1),[])});M.exports=l},89896:(M,T,s)=>{var e=s(64594);function d(n){var u=n==null?0:n.length;return u?e(n,1,u):[]}M.exports=d},69657:(M,T,s)=>{var e=s(47363),d=s(39416),n=s(40735),u=d(function(l,h){return n(l)?e(l,h):[]});M.exports=u},5135:(M,T,s)=>{"use strict";s.r(T),s.d(T,{default:()=>ds});var e=s(91320),d=s(38239),n=s(6264),u=s(71179),l=s(40965),h=s(92422),c=s(65676),p=s(70946),O=s(39160),_=s(2548),j=s(64150),D=s(43831),k=s(58095),K=s(86811),Z=s(46432),C=s(20674),B=s(64062),V=s(70269),b=s(44137),S=s(95978),H=s(20282),je=s(91245),De=s(22255),ne=s(69372),I=s(25587),ye=s(58767),Oe=s(96014),Re=s(71685),Ce=s(40076),Ae=s(17241),Le=s(69275),ve=s(37146),ie=s(84749),Te=s(78711),Be=s(60410),be=s(59712),Ue=s(58780),re=s(13768),W=s(67645),G=s(54769),L=s(417),Se=s(21681),ae=s(13779),w=s(96110),Y=s(9714),oe=s(9271),J=s(13406),We=s(69657),Ie=s(78181),Ke=s(89896),le=s(76251),Ze=s(52800),q=s(90217);const de=(0,d.createContext)({}),ce=({children:t,value:i})=>(0,e.jsx)(de.Provider,{value:i,children:t}),ee=()=>(0,d.useContext)(de);ce.propTypes={children:L.node.isRequired,value:L.object.isRequired};function $e(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Se(t.replace("api::","").replace("plugin::",""))}}const Ne=(t,i)=>{const r=Object.keys(i).sort().map(a=>({name:a,isOpen:!1}));return{...t,collapses:r}},ue=(0,Y.iv)`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,ke=(0,Y.ZP)(h.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&ue}
  &:hover {
    ${ue}
  }
`,Ge=Y.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,ge=({subCategory:t})=>{const{formatMessage:i}=(0,W.Z)(),{onChange:r,onChangeSelectAll:a,onSelectedAction:m,selectedAction:o,modifiedData:E}=ee(),f=(0,d.useMemo)(()=>w(E,t.name,{}),[E,t]),x=(0,d.useMemo)(()=>Object.values(f).every(g=>g.enabled===!0),[f]),P=(0,d.useMemo)(()=>Object.values(f).some(g=>g.enabled===!0)&&!x,[f,x]),y=(0,d.useCallback)(({target:{name:g}})=>{a({target:{name:g,value:!x}})},[x,a]),R=(0,d.useCallback)(g=>o===g,[o]);return(0,e.jsxs)(h.x,{children:[(0,e.jsxs)(c.k,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(h.x,{paddingRight:4,children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:t.label})}),(0,e.jsx)(Ge,{}),(0,e.jsx)(h.x,{paddingLeft:4,children:(0,e.jsx)(O.X,{name:t.name,value:x,onValueChange:g=>y({target:{name:t.name,value:g}}),indeterminate:P,children:i({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(c.k,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(_.r,{gap:2,style:{flex:1},children:t.actions.map(g=>{const A=`${g.name}.enabled`;return(0,e.jsx)(j.P,{col:6,children:(0,e.jsxs)(ke,{isActive:R(g.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(O.X,{value:w(E,A,!1),name:A,onValueChange:U=>r({target:{name:A,value:U}}),children:g.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>m(g.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(D.T,{as:"span",children:i({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:g.name})}),(0,e.jsx)(ve.Z,{})]})]})},g.name)})})})]})};ge.propTypes={subCategory:L.object.isRequired};const pe=({name:t,permissions:i})=>{const r=(0,d.useMemo)(()=>ae(Object.values(i.controllers).reduce((a,m,o)=>{const E=`${t}.controllers.${Object.keys(i.controllers)[o]}`,f=ae(Object.keys(m).reduce((x,P)=>[...x,{...m[P],label:P,name:`${E}.${P}`}],[]),"label");return[...a,{actions:f,label:Object.keys(i.controllers)[o],name:E}]},[]),"label"),[t,i]);return(0,e.jsx)(h.x,{padding:6,children:r.map(a=>(0,e.jsx)(ge,{subCategory:a},a.name))})};pe.propTypes={name:L.string.isRequired,permissions:L.object.isRequired};const Fe={collapses:[]},Qe=(t,i)=>(0,oe.ZP)(t,r=>{switch(i.type){case"TOGGLE_COLLAPSE":{r.collapses=t.collapses.map((a,m)=>m===i.index?{...a,isOpen:!a.isOpen}:{...a,isOpen:!1});break}default:return r}}),Ve=()=>{const{modifiedData:t}=ee(),{formatMessage:i}=(0,W.Z)(),[{collapses:r},a]=(0,d.useReducer)(Qe,Fe,o=>Ne(o,t)),m=o=>a({type:"TOGGLE_COLLAPSE",index:o});return(0,e.jsx)(c.k,{direction:"column",alignItems:"stretch",gap:1,children:r.map((o,E)=>(0,e.jsxs)(k.U,{expanded:o.isOpen,onToggle:()=>m(E),variant:E%2===0?"secondary":void 0,children:[(0,e.jsx)(K.B,{title:$e(o.name),description:i({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:o.name}),variant:E%2?"primary":"secondary"}),(0,e.jsx)(Z.v,{children:(0,e.jsx)(pe,{permissions:t[o.name],name:o.name})})]},o.name))})},He=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Ye=(0,Y.ZP)(h.x)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function se({route:t}){const{formatMessage:i}=(0,W.Z)(),{method:r,handler:a,path:m}=t,o=m?Ke(m.split("/")):[],[E="",f=""]=a?a.split("."):[],x=He(t.method);return(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(p.Z,{variant:"delta",as:"h3",children:[i({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:E}),(0,e.jsxs)(p.Z,{variant:"delta",textColor:"primary600",children:[".",f]})]}),(0,e.jsxs)(c.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Ye,{background:x.background,borderColor:x.border,padding:2,children:(0,e.jsx)(p.Z,{fontWeight:"bold",textColor:x.text,children:r})}),(0,e.jsx)(h.x,{paddingLeft:2,paddingRight:2,children:Ie(o,P=>(0,e.jsxs)(p.Z,{textColor:P.includes(":")?"neutral600":"neutral900",children:["/",P]},P))})]})]})}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:L.shape({handler:L.string,method:L.string,path:L.string})};const we=()=>{const{formatMessage:t}=(0,W.Z)(),{selectedAction:i,routes:r}=ee(),a=We(i.split("."),"controllers"),m=w(r,a[0]),o=a.slice(1).join("."),E=J(m)?[]:m.filter(f=>f.handler.endsWith(o));return(0,e.jsx)(j.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:i?(0,e.jsx)(c.k,{direction:"column",alignItems:"stretch",gap:2,children:E.map((f,x)=>(0,e.jsx)(se,{route:f},x))}):(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h3",children:t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},ze=(t,i,r)=>({...t,initialData:i,modifiedData:i,routes:r}),Xe={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},Je=(t,i)=>(0,oe.ZP)(t,r=>{switch(i.type){case"ON_CHANGE":{const a=i.keys.length,m=i.keys[a-1]==="enabled";if(i.value&&m){const o=Ze(i.keys,a-1).join(".");r.selectedAction=o}le(r,["modifiedData",...i.keys],i.value);break}case"ON_CHANGE_SELECT_ALL":{const a=["modifiedData",...i.keys],m=w(t,a,{}),o=Object.keys(m).reduce((E,f)=>(E[f]={...m[f],enabled:i.value},E),{});le(r,a,o);break}case"ON_RESET":{r.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{r.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:a}=i;r.selectedAction=a===t.selectedAction?"":a;break}default:return r}}),me=(0,d.forwardRef)(({permissions:t,routes:i},r)=>{const{formatMessage:a}=(0,W.Z)(),[m,o]=(0,d.useReducer)(Je,Xe,y=>ze(y,t,i));(0,d.useImperativeHandle)(r,()=>({getPermissions(){return{permissions:m.modifiedData}},resetForm(){o({type:"ON_RESET"})},setFormAfterSubmit(){o({type:"ON_SUBMIT_SUCCEEDED"})}}));const P={...m,onChange:({target:{name:y,value:R}})=>o({type:"ON_CHANGE",keys:y.split("."),value:R==="empty__string_value"?"":R}),onChangeSelectAll:({target:{name:y,value:R}})=>o({type:"ON_CHANGE_SELECT_ALL",keys:y.split("."),value:R}),onSelectedAction:y=>o({type:"SELECT_ACTION",actionToSelect:y})};return(0,e.jsx)(ce,{value:P,children:(0,e.jsxs)(_.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(j.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:a({id:(0,l.g)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:a({id:(0,l.g)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(Ve,{})]})}),(0,e.jsx)(we,{})]})})});me.propTypes={permissions:L.object.isRequired,routes:L.object.isRequired};const he=(0,d.memo)(me),Ee=q.Ry().shape({name:q.Z_().required(n.I0.required),description:q.Z_().required(n.I0.required)}),qe=t=>Object.keys(t).reduce((i,r)=>{const a=t[r].controllers,m=Object.keys(a).reduce((o,E)=>(J(a[E])||(o[E]=a[E]),o),{});return J(m)||(i[r]={controllers:m}),i},{}),xe=()=>{const t=(0,n.lm)(),{get:i}=(0,n.kY)(),{formatAPIError:r}=(0,n.So)(l.g),[{data:a,isLoading:m,error:o,refetch:E},{data:f,isLoading:x,error:P,refetch:y}]=(0,G.useQueries)([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:A}}=await i("/users-permissions/permissions");return A}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:A}}=await i("/users-permissions/routes");return A}}]),R=async()=>{await Promise.all([E(),y()])};(0,d.useEffect)(()=>{o&&t({type:"warning",message:r(o)})},[t,o,r]),(0,d.useEffect)(()=>{P&&t({type:"warning",message:r(P)})},[t,P,r]);const g=m||x;return{permissions:a?qe(a):{},routes:f??{},getData:R,isLoading:g}},es=()=>{const{formatMessage:t}=(0,W.Z)(),i=(0,n.lm)(),{goBack:r}=(0,u.k6)(),{lockApp:a,unlockApp:m}=(0,n.o1)(),{isLoading:o,permissions:E,routes:f}=xe(),{trackUsage:x}=(0,n.rS)(),P=d.useRef(),{post:y}=(0,n.kY)(),R=(0,G.useMutation)(A=>y("/users-permissions/roles",A),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})},onSuccess(){x("didCreateRole"),i({type:"success",message:{id:(0,l.g)("Settings.roles.created"),defaultMessage:"Role created"}}),r()}}),g=async A=>{a();const U=P.current.getPermissions();await R.mutate({...A,...U,users:[]}),m()};return(0,e.jsxs)(C.o,{children:[(0,e.jsx)(n.SL,{name:"Roles"}),(0,e.jsx)(re.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:g,validationSchema:Ee,children:({handleSubmit:A,values:U,handleChange:F,errors:v})=>(0,e.jsxs)(n.l0,{noValidate:!0,onSubmit:A,children:[(0,e.jsx)(B.T,{primaryAction:!o&&(0,e.jsx)(V.z,{type:"submit",loading:R.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(b.D,{children:(0,e.jsxs)(c.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:t({id:(0,l.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(_.r,{gap:4,children:[(0,e.jsx)(j.P,{col:6,children:(0,e.jsx)(S.o,{name:"name",value:U.name||"",onChange:F,label:t({id:"global.name",defaultMessage:"Name"}),error:v?.name?t({id:v.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(j.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:U.description||"",onChange:F,label:t({id:"global.description",defaultMessage:"Description"}),error:v?.description?t({id:v.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!o&&(0,e.jsx)(he,{ref:P,permissions:E,routes:f})]})})]})})]})},ss=()=>(0,e.jsx)(n.O4,{permissions:l.P.createRole,children:(0,e.jsx)(es,{})}),ts=()=>{const{formatMessage:t}=(0,W.Z)(),i=(0,n.lm)(),{lockApp:r,unlockApp:a}=(0,n.o1)(),{params:{id:m}}=(0,u.$B)("/settings/users-permissions/roles/:id"),{get:o}=(0,n.kY)(),{isLoading:E,routes:f}=xe(),{data:x,isLoading:P,refetch:y}=(0,G.useQuery)(["users-permissions","role",m],async()=>{const{data:{role:v}}=await o(`/users-permissions/roles/${m}`);return v}),R=d.useRef(),{put:g}=(0,n.kY)(),{formatAPIError:A}=(0,n.So)(),U=(0,G.useMutation)(v=>g(`/users-permissions/roles/${m}`,v),{onError(v){i({type:"warning",message:A(v)})},async onSuccess(){i({type:"success",message:{id:(0,l.g)("Settings.roles.created"),defaultMessage:"Role edited"}}),await y()}}),F=async v=>{r();const $=R.current.getPermissions();await U.mutate({...v,...$,users:[]}),a()};return P?(0,e.jsx)(n.dO,{}):(0,e.jsxs)(C.o,{children:[(0,e.jsx)(n.SL,{name:"Roles"}),(0,e.jsx)(re.J9,{enableReinitialize:!0,initialValues:{name:x.name,description:x.description},onSubmit:F,validationSchema:Ee,children:({handleSubmit:v,values:$,handleChange:z,errors:Q})=>(0,e.jsxs)(n.l0,{noValidate:!0,onSubmit:v,children:[(0,e.jsx)(B.T,{primaryAction:!E&&(0,e.jsx)(V.z,{disabled:x.code==="strapi-super-admin",type:"submit",loading:U.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:x.name,subtitle:x.description,navigationAction:(0,e.jsx)(n.rU,{startIcon:(0,e.jsx)(Te.Z,{}),to:"/settings/users-permissions/roles",children:t({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(b.D,{children:(0,e.jsxs)(c.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(c.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:t({id:(0,l.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(_.r,{gap:4,children:[(0,e.jsx)(j.P,{col:6,children:(0,e.jsx)(S.o,{name:"name",value:$.name||"",onChange:z,label:t({id:"global.name",defaultMessage:"Name"}),error:Q?.name?t({id:Q.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(j.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:$.description||"",onChange:z,label:t({id:"global.description",defaultMessage:"Description"}),error:Q?.description?t({id:Q.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!E&&(0,e.jsx)(he,{ref:R,permissions:x.permissions,routes:f})]})})]})})]})},ns=()=>(0,e.jsx)(n.O4,{permissions:l.P.updateRole,children:(0,e.jsx)(ts,{})}),is=(0,Y.ZP)(je.r)`
  align-items: center;
  height: ${(0,n.Q1)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:t})=>`${t.spaces[2]}}`};
  width: ${(0,n.Q1)(32)};

  svg {
    height: ${(0,n.Q1)(12)};
    width: ${(0,n.Q1)(12)};

    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:t})=>t.colors.neutral800};
      }
    }
  }
`,te=({sortedRoles:t,canDelete:i,permissions:r,setRoleToDelete:a,onDelete:m})=>{const{formatMessage:o}=(0,W.Z)(),{push:E}=(0,u.k6)(),[f,x]=m,P=g=>i&&!["public","authenticated"].includes(g.type),y=g=>{a(g),x(!f)},R=g=>{E(`/settings/users-permissions/roles/${g}`)};return(0,e.jsx)(De.p,{children:t?.map(g=>(0,e.jsxs)(ne.Tr,{...(0,n.X7)({fn:()=>R(g.id)}),children:[(0,e.jsx)(I.Td,{width:"20%",children:(0,e.jsx)(p.Z,{children:g.name})}),(0,e.jsx)(I.Td,{width:"50%",children:(0,e.jsx)(p.Z,{children:g.description})}),(0,e.jsx)(I.Td,{width:"30%",children:(0,e.jsx)(p.Z,{children:o({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:g.nb_users})})}),(0,e.jsx)(I.Td,{children:(0,e.jsxs)(c.k,{justifyContent:"end",...n.UW,children:[(0,e.jsx)(n.jW,{permissions:r.updateRole,children:(0,e.jsx)(is,{to:`/settings/users-permissions/roles/${g.id}`,"aria-label":o({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${g.name}`}),children:(0,e.jsx)(Be.Z,{})})}),P(g)&&(0,e.jsx)(n.jW,{permissions:r.deleteRole,children:(0,e.jsx)(ye.h,{onClick:()=>y(g.id),noBorder:!0,icon:(0,e.jsx)(be.Z,{}),label:o({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${g.name}`})})})]})})]},g.name))})};te.defaultProps={canDelete:!1},te.propTypes={onDelete:L.array.isRequired,permissions:L.object.isRequired,setRoleToDelete:L.func.isRequired,sortedRoles:L.array.isRequired,canDelete:L.bool};const rs=async(t,i)=>{try{const{get:r}=(0,n.tg)(),{data:a}=await r("/users-permissions/roles");return i("The roles have loaded successfully"),a}catch(r){throw t({type:"warning",message:{id:"notification.error"}}),new Error(r)}},as=async(t,i)=>{try{const{del:r}=(0,n.tg)();await r(`/users-permissions/roles/${t}`)}catch{i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},os=()=>{const{trackUsage:t}=(0,n.rS)(),{formatMessage:i,locale:r}=(0,W.Z)(),a=(0,n.lm)(),{notifyStatus:m}=(0,Oe.G)(),[{query:o}]=(0,n.Kx)(),E=o?._q||"",[f,x]=(0,d.useState)(!1),[P,y]=(0,d.useState)(!1),[R,g]=(0,d.useState)();(0,n.go)();const{isLoading:A,allowedActions:{canRead:U,canDelete:F}}=(0,n.ss)({create:l.P.createRole,read:l.P.readRoles,update:l.P.updateRole,delete:l.P.deleteRole}),{isLoading:v,data:{roles:$},isFetching:z,refetch:Q}=(0,G.useQuery)("get-roles",()=>rs(a,m),{initialData:{},enabled:U}),{includes:fe}=(0,n.L0)(r,{sensitivity:"base"}),Me=(0,n.Xe)(r,{sensitivity:"base"}),Pe=v||z,cs=()=>{x(!f)},us={roles:{id:(0,l.g)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,l.g)("Roles.empty.search"),defaultMessage:"No roles match the search."}},gs=i({id:"global.roles",defaultMessage:"Roles"}),ps=(0,G.useMutation)(N=>as(N,a),{async onSuccess(){await Q()}}),ms=async()=>{y(!0),await ps.mutateAsync(R),x(!f),y(!1)},X=($||[]).filter(N=>fe(N.name,E)||fe(N.description,E)).sort((N,_e)=>Me.compare(N.name,_e.name)||Me.compare(N.description,_e.description)),hs=E&&!X.length?"search":"roles",Es=4,xs=($?.length||0)+1;return(0,e.jsxs)(Re.A,{children:[(0,e.jsx)(n.SL,{name:gs}),(0,e.jsxs)(C.o,{"aria-busy":Pe,children:[(0,e.jsx)(B.T,{title:i({id:"global.roles",defaultMessage:"Roles"}),subtitle:i({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(n.jW,{permissions:l.P.createRole,children:(0,e.jsx)(n.Qj,{to:"/settings/users-permissions/roles/new",onClick:()=>t("willCreateRole"),startIcon:(0,e.jsx)(Ue.Z,{}),size:"S",children:i({id:(0,l.g)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(Ce.Z,{startActions:(0,e.jsx)(n.m,{label:i({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(b.D,{children:[!U&&(0,e.jsx)(n.ZF,{}),(Pe||A)&&(0,e.jsx)(n.dO,{}),U&&X&&X?.length?(0,e.jsxs)(Ae.i,{colCount:Es,rowCount:xs,children:[(0,e.jsx)(Le.h,{children:(0,e.jsxs)(ne.Tr,{children:[(0,e.jsx)(I.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:i({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(I.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:i({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(I.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:i({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(I.Th,{children:(0,e.jsx)(D.T,{children:i({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(te,{sortedRoles:X,canDelete:F,permissions:l.P,setRoleToDelete:g,onDelete:[f,x]})]}):(0,e.jsx)(n.x7,{content:us[hs]})]}),(0,e.jsx)(n.QH,{isConfirmButtonLoading:P,onConfirm:ms,onToggleDialog:cs,isOpen:f})]})]})},ls=()=>(0,e.jsx)(n.O4,{permissions:l.P.accessRoles,children:(0,e.jsx)(os,{})}),ds=()=>(0,e.jsx)(n.O4,{permissions:l.P.accessRoles,children:(0,e.jsxs)(u.rs,{children:[(0,e.jsx)(u.AW,{path:"/settings/users-permissions/roles/new",component:ss,exact:!0}),(0,e.jsx)(u.AW,{path:"/settings/users-permissions/roles/:id",component:ns,exact:!0}),(0,e.jsx)(u.AW,{path:"/settings/users-permissions/roles",component:ls,exact:!0}),(0,e.jsx)(u.AW,{path:"",component:n.Hn})]})})}}]);
