"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[8010],{48010:(j,L,s)=>{s.d(L,{ProtectedSSO:()=>Y});var t=s(91320),E=s(71685),i=s(20674),P=s(64062),D=s(70269),u=s(44137),B=s(65676),A=s(70946),h=s(2548),c=s(64150),K=s(32781),I=s(26277),r=s(89387),C=s(67133),o=s(6264),U=s(84749),W=s(58686),x=s(13768),M=s(67645),f=s(54769),T=s(5676),v=s(90217),F=s(49884),p=s(79377),X=s(6814),ns=s(38239),es=s(98297),ds=s(69158),ls=s(51896),Es=s(85904),is=s(70644),rs=s(39112),Ms=s(32805),Os=s(84770),Ps=s(67652),Ds=s(99321),gs=s(76350),Rs=s(22310),ms=s(96110),Ls=s(76251),cs=s(21977),vs=s(49470),As=s(17141),hs=s(21681),Is=s(38506),Cs=s(99135),fs=s(52800),Ts=s(62643),us=s(2863),Bs=s(4626),Ks=s(50589),Us=s(77315),Ws=s(89775),ys=s(56302),Ss=s(75376),js=s(50024),xs=s(92585),ps=s(64706),Ns=s(98064),Zs=s(87282),zs=s(10112),Fs=s(13406),Xs=s(35577),Qs=s(73607),Vs=s(38243),Ys=s(23889),Js=s(18334),$s=s(7405);const Q=v.Ry().shape({autoRegister:v.Xg().required(o.I0.required),defaultRole:v.nK().when("autoRegister",(a,d)=>a?d.required(o.I0.required):d.nullable()),ssoLockedRoles:v.IX().nullable().of(v.nK().when("ssoLockedRoles",(a,d)=>a?d.required(o.I0.required):d.nullable()))}),V=()=>{(0,o.go)();const{formatMessage:a}=(0,M.Z)(),d=(0,T.v9)(p.s),{lockApp:J,unlockApp:$}=(0,o.o1)(),y=(0,o.lm)(),{formatAPIError:G}=(0,o.So)(),{get:H,put:b}=(0,o.kY)(),{isLoading:k,data:w}=(0,f.useQuery)(["providers","options"],async()=>{const{data:e}=await H("/admin/providers/options");return e.data},{onError(){y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),N=(0,f.useMutation)(async e=>{const{autoRegister:g,defaultRole:O,ssoLockedRoles:n}=e,{data:R}=await b("/admin/providers/options",{autoRegister:g,defaultRole:O,ssoLockedRoles:n});return R.data},{async onSettled(){$()}}),{isLoading:q,allowedActions:{canUpdate:S,canReadRoles:ss}}=(0,o.ss)({...d.settings?.sso,readRoles:d.settings?.roles.read??[]}),{roles:Z,isLoading:ts}=(0,F.u)(void 0,{enabled:ss}),as=async(e,{resetForm:g,setErrors:O})=>{J(),N.mutate(e,{onSuccess(n){g({values:n}),y({type:"success",message:{id:"notification.success.saved"}})},onError(n){if(n instanceof W.d7&&n.response){const R=(0,X.f)(n.response.data),l=Object.keys(R).reduce((_,m)=>(_[m]=R[m].id,_),{});O(l),y({type:"warning",message:G(n)})}}})},{isLoading:os}=N,_s={autoRegister:!1,defaultRole:null,ssoLockedRoles:null},z=ts||q||k;return(0,t.jsxs)(E.A,{children:[(0,t.jsx)(o.SL,{name:"SSO"}),(0,t.jsx)(i.o,{"aria-busy":os||z,tabIndex:-1,children:(0,t.jsx)(x.J9,{onSubmit:as,initialValues:w||_s,validationSchema:Q,validateOnChange:!1,enableReinitialize:!0,children:({handleChange:e,isSubmitting:g,values:O,setFieldValue:n,dirty:R,errors:l})=>(0,t.jsxs)(o.l0,{children:[(0,t.jsx)(P.T,{primaryAction:(0,t.jsx)(D.z,{"data-testid":"save-button",disabled:!R,loading:g,startIcon:(0,t.jsx)(U.Z,{}),type:"submit",size:"L",children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:a({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,t.jsx)(u.D,{children:g||z?(0,t.jsx)(o.dO,{}):(0,t.jsxs)(B.k,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,t.jsx)(A.Z,{variant:"delta",as:"h2",children:a({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(h.r,{gap:4,children:[(0,t.jsx)(c.P,{col:6,s:12,children:(0,t.jsx)(K.s,{"data-testid":"autoRegister",disabled:!S,checked:O.autoRegister,hint:a({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:a({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:a({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:a({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:e})}),(0,t.jsx)(c.P,{col:6,s:12,children:(0,t.jsx)(I.P,{disabled:!S,hint:a({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:l.defaultRole?a({id:l.defaultRole,defaultMessage:l.defaultRole}):"",label:a({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:_=>e({target:{name:"defaultRole",value:_}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:O.defaultRole,children:Z.map(({id:_,name:m})=>(0,t.jsx)(r.W,{value:_.toString(),children:m},_))})}),(0,t.jsx)(c.P,{col:6,s:12,children:(0,t.jsx)(C.NU,{disabled:!S,hint:a({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:l.ssoLockedRoles?a({id:l.ssoLockedRoles,defaultMessage:l.ssoLockedRoles}):"",label:a({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:_=>e({target:{value:_,name:"ssoLockedRoles"}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>n("ssoLockedRoles",[]),value:O.ssoLockedRoles||[],withTags:!0,children:Z.map(({id:_,name:m})=>(0,t.jsx)(C.ML,{value:_.toString(),children:m},_))})})]})]})})]})})})]})},Y=()=>{const a=(0,T.v9)(p.s);return(0,t.jsx)(o.O4,{permissions:a.settings?.sso?.main,children:(0,t.jsx)(V,{})})}},6814:(j,L,s)=>{s.d(L,{f:()=>t});const t=({data:E})=>{try{return Object.keys(E).reduce((i,P)=>{const D=E[P][0];return i[P]={id:D,defaultMessage:D},i},{})}catch{return{}}}},49884:(j,L,s)=>{s.d(L,{u:()=>D});var t=s(38239),E=s(6264),i=s(67645),P=s(54769);const D=(u={},B={})=>{const{id:A="",...h}=u,{get:c}=(0,E.kY)(),{locale:K}=(0,i.Z)(),I=(0,E.Xe)(K,{sensitivity:"base"}),{data:r,error:C,isError:o,isLoading:U,refetch:W}=(0,P.useQuery)(["roles",A,h],async()=>{const{data:M}=await c(`/admin/roles/${A??""}`,{params:h});return M},B);return{roles:t.useMemo(()=>{let M=[];return r&&(Array.isArray(r.data)?M=r.data:M=[r.data]),[...M].sort((f,T)=>I.compare(f.name,T.name))},[r,I]),error:C,isError:o,isLoading:U,refetch:W}}}}]);
