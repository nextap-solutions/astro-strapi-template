"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[634],{634:(z,g,s)=>{s.d(g,{ProtectedEditPage:()=>G});var t=s(91320),D=s(38239),E=s(92422),l=s(65676),A=s(70946),h=s(70269),I=s(2548),O=s(64150),v=s(95978),T=s(20282),B=s(20674),L=s(64062),d=s(44137),U=s(6092),a=s(6264),W=s(78711),K=s(58686),j=s(13768),i=s(67645),f=s(54769),c=s(71179),$=s(42977),y=s(90217),Q=s(51896),Y=s(49884),H=s(79377),S=s(92789),ds=s(85904),rs=s(70644),ls=s(39112),Ps=s(32805),Ms=s(84770),es=s(67652),Ds=s(5676),Os=s(99321),ms=s(76350),Rs=s(22310),As=s(96110),hs=s(76251),vs=s(21977),Ls=s(49470),cs=s(17141),Cs=s(21681),gs=s(38506),Is=s(99135),Ts=s(52800),Bs=s(62643),Us=s(2863),Ws=s(4626),Ks=s(50589),fs=s(77315),xs=s(89775),us=s(56302),js=s(75376),ys=s(50024),Ss=s(92585),ps=s(64706),Zs=s(98064),Ns=s(87282),Fs=s(10112),zs=s(13406),$s=s(35577),Qs=s(73607),Ys=s(38243),Hs=s(23889),Js=s(18334),Vs=s(7405),Xs=s(98297),Gs=s(69158),bs=s(43619),ks=s(38542);const J=({disabled:r,role:n,values:m,errors:_,onChange:R,onBlur:C})=>{const{formatMessage:o}=(0,i.Z)();return(0,t.jsx)(E.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(l.k,{justifyContent:"space-between",children:[(0,t.jsxs)(E.x,{children:[(0,t.jsx)(E.x,{children:(0,t.jsx)(A.Z,{fontWeight:"bold",children:n?n.name:o({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(E.x,{children:(0,t.jsx)(A.Z,{textColor:"neutral500",variant:"pi",children:n?n.description:o({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(h.z,{disabled:!0,variant:"secondary",children:o({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:n.usersCount})})]}),(0,t.jsxs)(I.r,{gap:4,children:[(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(v.o,{disabled:r,name:"name",error:_.name&&o({id:_.name}),label:o({id:"global.name",defaultMessage:"Name"}),onChange:R,onBlur:C,required:!0,value:m.name||""})}),(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(T.g,{disabled:r,label:o({id:"global.description",defaultMessage:"Description"}),id:"description",error:_.name&&o({id:_.name}),onChange:R,onBlur:C,children:m.description||""})})]})]})})},V=y.Ry().shape({name:y.Z_().required(a.I0.required)}),X=()=>{const r=(0,a.lm)(),{formatMessage:n}=(0,i.Z)(),_=(0,c.$B)("/settings/roles/:id")?.params.id,{put:R,get:C}=(0,a.kY)(),[o,p]=D.useState(!1),x=D.useRef(null),{lockApp:b,unlockApp:k}=(0,a.o1)(),{trackUsage:w}=(0,a.rS)(),{formatAPIError:q}=(0,a.So)(),{isLoading:ss,data:Z}=(0,f.useQuery)(["permissions",_],async()=>{const{data:{data:M}}=await C("/admin/permissions",{params:{role:_}});return M},{cacheTime:0}),{roles:ts,isLoading:N,refetch:_s}=(0,Y.u)({id:_},{cacheTime:0}),P=ts[0]??{},{permissions:as,isLoading:ns}=(0,S.u)({id:_??null},{cacheTime:0}),os=async M=>{try{b?.(),p(!0);const{permissionsToSend:e,didUpdateConditions:u}=x.current?.getPermissions()??{};await R(`/admin/roles/${_}`,M),P.code!=="strapi-super-admin"&&(await R(`/admin/roles/${_}/permissions`,{permissions:e}),u&&w("didUpdateConditions")),x.current?.setFormAfterSubmit(),await _s(),r({type:"success",message:{id:"notification.success.saved"}})}catch(e){e instanceof K.d7&&r({type:"warning",message:q(e)})}finally{p(!1),k?.()}},F=!N&&P.code==="strapi-super-admin";return(0,t.jsxs)(B.o,{children:[(0,t.jsx)(a.SL,{name:"Roles"}),(0,t.jsx)(j.J9,{enableReinitialize:!0,initialValues:{name:P.name??"",description:P.description??""},onSubmit:os,validationSchema:V,validateOnChange:!1,children:({handleSubmit:M,values:e,errors:u,handleChange:Es,handleBlur:is})=>(0,t.jsxs)("form",{onSubmit:M,children:[(0,t.jsx)(L.T,{primaryAction:(0,t.jsx)(l.k,{gap:2,children:(0,t.jsx)(h.z,{type:"submit",disabled:P.code==="strapi-super-admin",onClick:M,loading:o,size:"L",children:n({id:"global.save",defaultMessage:"Save"})})}),title:n({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(U.r,{as:$.OL,startIcon:(0,t.jsx)(W.Z,{}),to:"/settings/roles",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(d.D,{children:(0,t.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(J,{disabled:F,errors:u,values:e,onChange:Es,onBlur:is,role:P}),!ss&&!N&&!ns&&Z?(0,t.jsx)(E.x,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(S.P,{isFormDisabled:F,permissions:as,ref:x,layout:Z})}):(0,t.jsx)(E.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(a.dO,{})})]})})]})})]})},G=()=>{const r=(0,Q.f)(H.s),{isLoading:n,allowedActions:{canRead:m,canUpdate:_}}=(0,a.ss)(r.settings?.roles);return n?(0,t.jsx)(a.dO,{}):!m&&!_?(0,t.jsx)(c.l_,{to:"/"}):(0,t.jsx)(X,{})}},49884:(z,g,s)=>{s.d(g,{u:()=>A});var t=s(38239),D=s(6264),E=s(67645),l=s(54769);const A=(h={},I={})=>{const{id:O="",...v}=h,{get:T}=(0,D.kY)(),{locale:B}=(0,E.Z)(),L=(0,D.Xe)(B,{sensitivity:"base"}),{data:d,error:U,isError:a,isLoading:W,refetch:K}=(0,l.useQuery)(["roles",O,v],async()=>{const{data:i}=await T(`/admin/roles/${O??""}`,{params:v});return i},I);return{roles:t.useMemo(()=>{let i=[];return d&&(Array.isArray(d.data)?i=d.data:i=[d.data]),[...i].sort((f,c)=>L.compare(f.name,c.name))},[d,L]),error:U,isError:a,isLoading:W,refetch:K}}}}]);
