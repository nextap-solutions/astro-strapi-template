"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[3734],{83734:(H,P,s)=>{s.d(P,{ProtectedEditPage:()=>as});var a=s(91320),e=s(38239),d=s(20674),E=s(64062),r=s(70269),D=s(44137),p=s(92422),U=s(65676),x=s(70946),T=s(2548),B=s(64150),j=s(6092),t=s(6264),y=s(84749),S=s(78711),V=s(58686),O=s(13768),_=s(96110),g=s(76350),L=s(84770),R=s(67645),m=s(71179),v=s(42977),l=s(90217),I=s(51896),u=s(79377),X=s(6814),Z=s(53245),o=s(33472),ds=s(85904),_s=s(70644),ls=s(39112),Es=s(32805),Ms=s(67652),ms=s(5676),cs=s(54769),Ps=s(99321),Ds=s(22310),Os=s(76251),gs=s(21977),hs=s(49470),fs=s(17141),As=s(21681),Ls=s(38506),vs=s(99135),Is=s(52800),us=s(62643),Cs=s(2863),ps=s(4626),Us=s(50589),Ts=s(77315),Bs=s(89775),Rs=s(56302),Ks=s(75376),Ws=s(50024),xs=s(92585),js=s(64706),ys=s(98064),Ss=s(87282),Zs=s(10112),zs=s(13406),Ns=s(35577),$s=s(73607),Fs=s(38243),Ys=s(23889),Hs=s(18334),Vs=s(7405),Xs=s(98297),Js=s(69158);const k=l.Ry().shape({...o.C,isActive:l.Xg(),roles:l.IX().min(1,t.I0.required).required(t.I0.required)}),G=["email","firstname","lastname","username","isActive","roles"],q=()=>{const{put:z}=(0,t.kY)(),{formatMessage:n}=(0,R.Z)(),h=(0,m.$B)("/settings/users/:id")?.params?.id??"",{push:K}=(0,m.k6)(),{setUserDisplayName:J}=(0,t.L7)(),C=(0,t.lm)(),{lockApp:ts,unlockApp:es}=(0,t.o1)(),w=(0,I.j)(Z.M,async()=>(await s.e(5395).then(s.bind(s,85395))).MagicLinkEE),{formatAPIError:os}=(0,t.So)(),b=(0,I.f)(u.s),{isLoading:ns,allowedActions:{canUpdate:Q}}=(0,t.ss)({read:b.settings?.users.read??[],update:b.settings?.users.update??[]});(0,t.go)();const{users:[$],isLoading:is}=(0,I.g)({id:h},{cacheTime:0,onError(i){const{status:f}=i.response??{};f===403?(C({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),K("/")):C({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}});if(is||!w||ns)return(0,a.jsxs)(d.o,{"aria-busy":"true",children:[(0,a.jsx)(t.SL,{name:"Users"}),(0,a.jsx)(E.T,{primaryAction:(0,a.jsx)(r.z,{disabled:!0,startIcon:(0,a.jsx)(y.Z,{}),type:"button",size:"L",children:n({id:"global.save",defaultMessage:"Save"})}),title:n({id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}),navigationAction:(0,a.jsx)(j.r,{as:v.OL,startIcon:(0,a.jsx)(S.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsx)(D.D,{children:(0,a.jsx)(t.dO,{})})]});const F={...L($,G),roles:$.roles.map(({id:i})=>i),password:"",confirmPassword:""},rs=async(i,f)=>{ts?.();try{const{data:{data:M}}=await z(`/admin/users/${h}`,g(i,"confirmPassword"));C({type:"success",message:n({id:"notification.success.saved",defaultMessage:"Saved"})});const A=t.I8.getUserInfo();if(h.toString()===A?.id.toString()){t.I8.setUserInfo(M);const W=_(i,"username")||(0,u.g)(i?.firstname??"",i.lastname);J(W)}f.setValues({...L(i,G),password:"",confirmPassword:""})}catch(M){if(M instanceof V.d7&&M.response){const A=(0,X.f)(M.response.data),W=Object.keys(A).reduce((Y,c)=>(Y[c]=A[c].id,Y),{});f.setErrors(W),C({type:"warning",message:os(M)})}}es?.()};return(0,a.jsxs)(d.o,{children:[(0,a.jsx)(t.SL,{name:"Users"}),(0,a.jsx)(O.J9,{onSubmit:rs,initialValues:F,validateOnChange:!1,validationSchema:k,children:({errors:i,values:f,handleChange:M,isSubmitting:A,dirty:W})=>(0,a.jsxs)(t.l0,{children:[(0,a.jsx)(E.T,{primaryAction:(0,a.jsx)(r.z,{disabled:A||!Q?!0:!W,startIcon:(0,a.jsx)(y.Z,{}),loading:A,type:"submit",size:"L",children:n({id:"global.save",defaultMessage:"Save"})}),title:n({id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},{name:F.username||(0,u.g)(F?.firstname??"",F.lastname)}),navigationAction:(0,a.jsx)(j.r,{as:v.OL,startIcon:(0,a.jsx)(S.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsxs)(D.D,{children:[$?.registrationToken&&(0,a.jsx)(p.x,{paddingBottom:6,children:(0,a.jsx)(w,{registrationToken:$.registrationToken})}),(0,a.jsxs)(U.k,{direction:"column",alignItems:"stretch",gap:7,children:[(0,a.jsx)(p.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(U.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(x.Z,{variant:"delta",as:"h2",children:n({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),(0,a.jsx)(T.r,{gap:5,children:ss.map(Y=>Y.map(c=>(0,a.jsx)(B.P,{...c.size,children:(0,a.jsx)(t.jm,{...c,disabled:!Q,error:i[c.name],onChange:M,value:f[c.name]})},c.name)))})]})}),(0,a.jsx)(p.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(U.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(x.Z,{variant:"delta",as:"h2",children:n({id:"global.roles",defaultMessage:"User's role"})}),(0,a.jsx)(T.r,{gap:5,children:(0,a.jsx)(B.P,{col:6,xs:12,children:(0,a.jsx)(Z.S,{disabled:!Q,error:i.roles,onChange:M,value:f.roles})})})]})})]})]})]})})]})},ss=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],as=()=>{const z=(0,t.lm)(),n=(0,I.f)(u.s),{isLoading:N,allowedActions:{canRead:h,canUpdate:K}}=(0,t.ss)({read:n.settings?.users.read??[],update:n.settings?.users.update??[]}),{state:J}=(0,m.TH)(),C=J?.from??"/";return e.useEffect(()=>{N||!h&&!K&&z({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[N,h,K,z]),N?(0,a.jsx)(t.dO,{}):!h&&!K?(0,a.jsx)(m.l_,{to:C}):(0,a.jsx)(q,{})}},53245:(H,P,s)=>{s.d(P,{M:()=>j,S:()=>t,a:()=>B});var a=s(91320),e=s(67645),d=s(51896),E=s(58767),r=s(67133),D=s(6264),p=s(34064),U=s(15656),x=s(54769),T=s(9714);const B=({children:O,target:_})=>{const g=(0,D.lm)(),{formatMessage:L}=(0,e.Z)(),{copy:R}=(0,D.VP)(),m=L({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),v=async()=>{await R(_)&&g({type:"info",message:{id:"notification.link-copied"}})};return(0,a.jsx)(D.Y_,{endAction:(0,a.jsx)(E.h,{label:m,noBorder:!0,icon:(0,a.jsx)(p.Z,{}),onClick:v}),title:_,titleEllipsis:!0,subtitle:O,icon:(0,a.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},j=({registrationToken:O})=>{const{formatMessage:_}=(0,e.Z)(),g=`${window.location.origin}${(0,d.p)()}/auth/register?registrationToken=${O}`;return(0,a.jsx)(B,{target:g,children:_({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},t=({disabled:O,error:_,onChange:g,value:L})=>{const{get:R}=(0,D.kY)(),{isLoading:m,data:v}=(0,x.useQuery)(["roles"],async()=>{const{data:{data:o}}=await R("/admin/roles");return o},{staleTime:5e4}),{formatMessage:l}=(0,e.Z)(),I=_?l({id:_,defaultMessage:_}):"",u=l({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),X=l({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),Z=l({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,a.jsx)(r.NU,{id:"roles",disabled:O,error:I,hint:X,label:u,name:"roles",onChange:o=>{g({target:{name:"roles",value:o}})},placeholder:Z,startIcon:m?(0,a.jsx)(V,{}):void 0,value:L.map(o=>o.toString()),withTags:!0,required:!0,children:(v??[]).map(o=>(0,a.jsx)(r.ML,{value:o.id.toString(),children:l({id:`global.${o.code}`,defaultMessage:o.name})},o.id))})},y=(0,T.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,S=T.ZP.div`
  animation: ${y} 2s infinite linear;
`,V=()=>(0,a.jsx)(S,{children:(0,a.jsx)(U.Z,{})})},6814:(H,P,s)=>{s.d(P,{f:()=>a});const a=({data:e})=>{try{return Object.keys(e).reduce((d,E)=>{const r=e[E][0];return d[E]={id:r,defaultMessage:r},d},{})}catch{return{}}}},33472:(H,P,s)=>{s.d(P,{C:()=>d});var a=s(6264),e=s(90217);const d={firstname:e.Z_().trim().required(a.I0.required),lastname:e.Z_(),email:e.Z_().email(a.I0.email).lowercase().required(a.I0.required),username:e.Z_().nullable(),password:e.Z_().min(8,a.I0.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Z_().min(8,a.I0.minLength).oneOf([e.iH("password"),null],"components.Input.error.password.noMatch").when("password",(E,r)=>E?r.required(a.I0.required):r)}}}]);
