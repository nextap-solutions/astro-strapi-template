"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[1878],{11878:(Q,L,t)=>{t.d(L,{ProtectedListView:()=>dt});var s=t(91320),O=t(38239),W=t(20674),K=t(64062),l=t(68210),A=t(44137),e=t(6264),U=t(58780),R=t(58686),f=t(22310),o=t(67645),v=t(54769),g=t(5676),x=t(71179),m=t(79377),T=t(73047),j=t(37272),$=t(98297),F=t(69158),V=t(51896),k=t(85904),y=t(70644),Y=t(39112),H=t(32805),J=t(84770),z=t(67652),a=t(13768),E=t(99321),D=t(90217),M=t(76350),P=t(96110),i=t(76251),d=t(21977),c=t(49470),r=t(17141),h=t(21681),G=t(38506),X=t(99135),w=t(52800),b=t(62643),q=t(2863),n=t(4626),tt=t(50589),p=t(77315),Lt=t(89775),vt=t(56302),It=t(75376),Ut=t(50024),Rt=t(92585),gt=t(64706),ht=t(98064),Bt=t(87282),Wt=t(10112),Kt=t(13406),ft=t(35577),xt=t(73607),jt=t(38243),yt=t(23889),pt=t(18334),ut=t(7405);const ot=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],Et=()=>{(0,e.go)();const u=(0,v.useQueryClient)(),{formatMessage:I}=(0,o.Z)(),st=(0,e.lm)(),it=(0,g.v9)(m.s),{allowedActions:{canCreate:S,canDelete:lt,canUpdate:Dt,canRead:C}}=(0,e.ss)(it.settings?.["api-tokens"]),{push:at}=(0,x.k6)(),{trackUsage:B}=(0,e.rS)(),{startSection:Mt}=(0,e.c1)(),nt=O.useRef(Mt),{get:Pt,del:rt}=(0,e.kY)(),{formatAPIError:_t}=(0,e.So)();O.useEffect(()=>{nt.current&&nt.current("apiTokens")},[]),O.useEffect(()=>{at({search:f.stringify({sort:"name:ASC"},{encode:!1})})},[at]);const Ot=ot.map(_=>({..._,metadatas:{..._.metadatas,label:I(_.metadatas.label)}})),{data:Z,isLoading:Tt}=(0,v.useQuery)(["api-tokens"],async()=>{B("willAccessTokenList",{tokenType:T.A});const{data:{data:_}}=await Pt("/admin/api-tokens");return B("didAccessTokenList",{number:_.length,tokenType:T.A}),_},{cacheTime:0,enabled:C,onError(_){_ instanceof R.d7&&st({type:"warning",message:_t(_)})}}),et=Tt,At=(0,v.useMutation)(async _=>{await rt(`/admin/api-tokens/${_}`)},{async onSuccess(){await u.invalidateQueries(["api-tokens"]),B("didDeleteToken")},onError(_){_ instanceof R.d7&&st({type:"warning",message:_t(_)})}}),N=Z&&Z.length>0,mt=C&&N,ct=C&&!N&&!S,Ct=C&&!N&&S;return(0,s.jsxs)(W.o,{"aria-busy":et,children:[(0,s.jsx)(e.SL,{name:"API Tokens"}),(0,s.jsx)(K.T,{title:I({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:I({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:S&&(0,s.jsx)(l.Q,{"data-testid":"create-api-token-button",startIcon:(0,s.jsx)(U.Z,{}),size:"S",onClick:()=>B("willAddTokenFromList",{tokenType:T.A}),to:"/settings/api-tokens/create",children:I({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})})}),(0,s.jsxs)(A.D,{children:[!C&&(0,s.jsx)(e.ZF,{}),mt&&(0,s.jsx)(j.T,{permissions:{canRead:C,canDelete:lt,canUpdate:Dt},headers:Ot,contentType:"api-tokens",isLoading:et,onConfirmDelete:_=>At.mutateAsync(_),tokens:Z,tokenType:T.A}),Ct&&(0,s.jsx)(e.dJ,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:(0,s.jsx)(l.Q,{variant:"secondary",startIcon:(0,s.jsx)(U.Z,{}),to:"/settings/api-tokens/create",children:I({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"})})}),ct&&(0,s.jsx)(e.dJ,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},dt=()=>{const u=(0,g.v9)(m.s);return(0,s.jsx)(e.O4,{permissions:u.settings?.["api-tokens"].main,children:(0,s.jsx)(Et,{})})}},37272:(Q,L,t)=>{t.d(L,{T:()=>F});var s=t(91320),O=t(38239),W=t(22255),K=t(69372),l=t(25587),A=t(70946),e=t(65676),U=t(92422),R=t(58767),f=t(6092),o=t(6264),v=t(59712),g=t(62545),x=t(60410),m=t(67645),T=t(71179),j=t(42977),$=t(9714);const F=({permissions:a,headers:E=[],contentType:D,isLoading:M=!1,tokens:P=[],onConfirmDelete:i,tokenType:d})=>{const{canDelete:c,canUpdate:r,canRead:h}=a;return(0,s.jsx)(o.tM,{headers:E,contentType:D,rows:P,withBulkActions:c||r||h,isLoading:M,onConfirmDelete:i,children:(0,s.jsx)(V,{tokenType:d,permissions:a,onConfirmDelete:i})})},V=({tokenType:a,permissions:E,rows:D=[],withBulkActions:M,onConfirmDelete:P})=>{const{canDelete:i,canUpdate:d,canRead:c}=E,[{query:r}]=(0,o.Kx)(),{formatMessage:h}=(0,m.Z)(),[,G]=r&&r.sort?r.sort.split(":"):[void 0,"ASC"],{push:X,location:{pathname:w}}=(0,T.k6)(),{trackUsage:b}=(0,o.rS)(),q=D.sort((n,tt)=>{const p=n.name.localeCompare(tt.name);return G==="DESC"?-p:p});return(0,s.jsx)(W.p,{children:q.map(n=>(0,s.jsxs)(K.Tr,{...(0,o.X7)({fn(){b("willEditTokenFromList",{tokenType:a}),X(`${w}/${n.id}`)},condition:d}),children:[(0,s.jsx)(l.Td,{maxWidth:(0,o.Q1)(250),children:(0,s.jsx)(A.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:n.name})}),(0,s.jsx)(l.Td,{maxWidth:(0,o.Q1)(250),children:(0,s.jsx)(A.Z,{textColor:"neutral800",ellipsis:!0,children:n.description})}),(0,s.jsx)(l.Td,{children:(0,s.jsx)(A.Z,{textColor:"neutral800",children:(0,s.jsx)(o.ij,{timestamp:new Date(n.createdAt)})})}),(0,s.jsx)(l.Td,{children:n.lastUsedAt&&(0,s.jsx)(A.Z,{textColor:"neutral800",children:(0,s.jsx)(o.ij,{timestamp:new Date(n.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:h({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),M&&(0,s.jsx)(l.Td,{children:(0,s.jsxs)(e.k,{justifyContent:"end",children:[d&&(0,s.jsx)(z,{tokenName:n.name,tokenId:n.id}),!d&&c&&(0,s.jsx)(J,{tokenName:n.name,tokenId:n.id}),i&&(0,s.jsx)(H,{tokenName:n.name,onClickDelete:()=>P?.(n.id),tokenType:a})]})})]},n.id))})},k={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},y=({tokenName:a,tokenId:E,buttonType:D="edit",children:M})=>{const{formatMessage:P}=(0,m.Z)(),{location:{pathname:i}}=(0,T.k6)();return(0,s.jsx)(Y,{forwardedAs:j.OL,to:`${i}/${E}`,title:P(k[D],{target:a}),children:M})},Y=(0,$.ZP)(f.r)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,H=({tokenName:a,onClickDelete:E,tokenType:D})=>{const{formatMessage:M}=(0,m.Z)(),{trackUsage:P}=(0,o.rS)(),[i,d]=O.useState(!1),c=()=>{d(!1),P("willDeleteToken",{tokenType:D}),E()};return(0,s.jsxs)(U.x,{paddingLeft:1,onClick:r=>r.stopPropagation(),children:[(0,s.jsx)(R.h,{onClick:()=>{d(!0)},label:M({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",borderWidth:0,icon:(0,s.jsx)(v.Z,{})}),(0,s.jsx)(o.QH,{onToggleDialog:()=>d(!1),onConfirm:c,isOpen:i})]})},J=({tokenName:a,tokenId:E})=>(0,s.jsx)(y,{tokenName:a,tokenId:E,buttonType:"read",children:(0,s.jsx)(g.Z,{})}),z=({tokenName:a,tokenId:E})=>(0,s.jsx)(y,{tokenName:a,tokenId:E,children:(0,s.jsx)(x.Z,{})})},73047:(Q,L,t)=>{t.d(L,{A:()=>s,T:()=>O});const s="api-token",O="transfer-token"}}]);
