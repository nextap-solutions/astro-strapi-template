"use strict";(self.webpackChunkcms=self.webpackChunkcms||[]).push([[1448],{51448:($,v,t)=>{t.r(v),t.d(v,{InformationBoxEE:()=>k});var s=t(91320),a=t(6264),r=t(51896),R=t(21276),l=t(65676),B=t(93522),L=t(67303),D=t(67626),U=t(70946),G=t(94060),Q=t(81473),V=t(39822),Y=t(67645),x=t(54769),e=t(72132),S=t(38239),z=t(39083),C=t(30019),K=t(16706),F=t(6512),b=t(85904),q=t(70644),tt=t(39112),st=t(32805),at=t(84770),nt=t(67652),ot=t(5676),et=t(13768),_t=t(99321),lt=t(90217),it=t(76350),rt=t(22310),Et=t(96110),dt=t(76251),Mt=t(21977),gt=t(49470),mt=t(17141),Dt=t(21681),Ot=t(38506),Pt=t(99135),ct=t(52800),ht=t(62643),vt=t(2863),Ct=t(4626),At=t(50589),Wt=t(77315),It=t(89775),Lt=t(56302),ut=t(75376),ft=t(50024),Tt=t(92585),Rt=t(64706),Bt=t(98064),Ut=t(87282),Kt=t(10112),yt=t(13406),jt=t(35577),xt=t(73607),St=t(38243),pt=t(23889),wt=t(18334),Nt=t(7405);const H=()=>{const{initialData:_,layout:E,isSingleType:O,onChange:u}=(0,a.Wq)(),A=(0,r.f)(o=>o.admin_app.permissions),{formatMessage:n}=(0,Y.Z)(),{formatAPIError:f}=(0,a.So)(),M=(0,a.lm)(),{put:T}=(0,a.kY)(),{allowedActions:{canRead:d},isLoading:P}=(0,a.ss)(A.settings?.users),{users:W,isLoading:I,isError:y}=(0,r.g)({},{enabled:!P&&d}),c=_?.[e.A]??null,h=async o=>{i.mutate({entityId:_.id,assigneeId:o?parseInt(o,10):null,uid:E.uid})},i=(0,x.useMutation)(async({entityId:o,assigneeId:p,uid:w})=>{const g=O?"single-types":"collection-types",{data:{data:m}}=await T(`/admin/content-manager/${g}/${w}/${o}/assignee`,{data:{id:p}});return u?.({target:{type:"",name:e.A,value:m[e.A]}},!0),m},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.assignee.notification.saved",defaultMessage:"Assignee updated"}})}});return(0,s.jsx)(R.g,{name:e.A,id:e.A,children:(0,s.jsx)(l.k,{direction:"column",gap:2,alignItems:"stretch",children:(0,s.jsx)(B.hQ,{clearLabel:n({id:"content-manager.reviewWorkflows.assignee.clear",defaultMessage:"Clear assignee"}),error:(y&&d&&n({id:"content-manager.reviewWorkflows.assignee.error",defaultMessage:"An error occurred while fetching users"})||i.error&&f(i.error))??void 0,disabled:!P&&!I&&W.length===0,name:e.A,id:e.A,value:c?c.id.toString():null,onChange:h,onClear:()=>h(null),placeholder:n({id:"content-manager.reviewWorkflows.assignee.placeholder",defaultMessage:"Select \u2026"}),label:n({id:"content-manager.reviewWorkflows.assignee.label",defaultMessage:"Assignee"}),loading:I||P||i.isLoading,children:W.map(o=>(0,s.jsx)(L.O,{value:o.id.toString(),textValue:(0,r.h)(o,n),children:(0,r.h)(o,n)},o.id))})})})};function J({id:_,layout:E},O={}){const{kind:u,uid:A}=E,n=u==="collectionType"?"collection-types":"single-types",{get:f}=(0,a.kY)(),{data:M,isLoading:T,refetch:d}=(0,x.useQuery)(["content-manager",n,A,_,"stages"],async()=>{const{data:I}=await f(`/admin/content-manager/${n}/${A}/${_}/stages`);return I},O),P=S.useMemo(()=>M?.meta??{workflowCount:0},[M?.meta]),W=S.useMemo(()=>M?.data??[],[M?.data]);return{meta:P,stages:W,isLoading:T,refetch:d}}const X=()=>{const{initialData:_,layout:E,isSingleType:O,onChange:u}=(0,a.Wq)(),{put:A}=(0,a.kY)(),{formatMessage:n}=(0,Y.Z)(),{formatAPIError:f}=(0,a.So)(),M=(0,a.lm)(),{meta:T,stages:d,isLoading:P,refetch:W}=J({id:_.id,layout:E},{enabled:!!_?.id}),{getFeature:I}=(0,z.u)(),[y,c]=S.useState(null),h=I("review-workflows")??{},i=_?.[e.S]??null,o=(0,x.useMutation)(async({entityId:g,stageId:m,uid:j})=>{const N=O?"single-types":"collection-types",{data:{data:Z}}=await A(`/admin/content-manager/${N}/${j}/${g}/stage`,{data:{id:m}});return u?.({target:{name:e.S,value:Z[e.S],type:""}},!0),await W(),Z},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.stage.notification.saved",defaultMessage:"Review stage updated"}})}}),p=async g=>{try{h?.[K.C]&&parseInt(h[K.C],10)<T.workflowCount?c("workflow"):h?.[K.a]&&parseInt(h[K.a],10)<d.length?c("stage"):_.id&&E&&o.mutateAsync({entityId:_.id,stageId:g,uid:E.uid})}catch{}},{themeColorName:w}=(0,F.g)(i?.color)??{};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.g,{hint:d.length===0&&n({id:"content-manager.reviewWorkflows.stages.no-transition",defaultMessage:"You don\u2019t have the permission to update this stage."}),name:e.S,id:e.S,children:(0,s.jsxs)(l.k,{direction:"column",gap:2,alignItems:"stretch",children:[(0,s.jsx)(D.q4,{disabled:d.length===0,error:o.error&&f(o.error)||void 0,name:e.S,id:e.S,value:i?.id,onChange:p,label:n({id:"content-manager.reviewWorkflows.stage.label",defaultMessage:"Review stage"}),startIcon:i&&(0,s.jsx)(l.k,{as:"span",height:2,background:i?.color,borderColor:w==="neutral0"?"neutral150":void 0,hasRadius:!0,shrink:0,width:2,marginRight:"-3px"}),customizeContent:()=>(0,s.jsxs)(l.k,{as:"span",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,s.jsx)(U.Z,{textColor:"neutral800",ellipsis:!0,children:i?.name??""}),P?(0,s.jsx)(G.a,{small:!0,style:{display:"flex"},"data-testid":"loader"}):null]}),children:d.map(({id:g,color:m,name:j})=>{const{themeColorName:N}=(0,F.g)(m)??{};return(0,s.jsx)(D.ag,{startIcon:(0,s.jsx)(l.k,{height:2,background:m,borderColor:N==="neutral0"?"neutral150":void 0,hasRadius:!0,shrink:0,width:2}),value:g,textValue:j,children:j},g)})}),(0,s.jsx)(Q.J,{}),(0,s.jsx)(V.c,{})]})}),(0,s.jsxs)(C.L.Root,{isOpen:y==="workflow",onClose:()=>c(null),children:[(0,s.jsx)(C.L.Title,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,s.jsx)(C.L.Body,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,s.jsxs)(C.L.Root,{isOpen:y==="stage",onClose:()=>c(null),children:[(0,s.jsx)(C.L.Title,{children:n({id:"content-manager.reviewWorkflows.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,s.jsx)(C.L.Body,{children:n({id:"content-manager.reviewWorkflows.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})},k=()=>{const{isCreatingEntry:_,layout:E}=(0,a.Wq)(),O=E?.options?.reviewWorkflows??!1;return(0,s.jsxs)(r.I.Root,{children:[(0,s.jsx)(r.I.Title,{}),O&&!_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(X,{}),(0,s.jsx)(H,{})]}),(0,s.jsx)(r.I.Body,{})]})}},6512:($,v,t)=>{t.d(v,{a:()=>R,g:()=>r});var s=t(40797),a=t(16706);function r(l){if(!l)return null;const L=Object.entries(s.W.colors).filter(([,D])=>D.toUpperCase()===l.toUpperCase()).reduce((D,[U])=>(a.S?.[U]&&(D=U),D),null);return L?{themeColorName:L,name:a.S[L]}:null}function R(){return Object.entries(a.S).map(([l,B])=>({hex:s.W.colors[l].toUpperCase(),name:B}))}},72132:($,v,t)=>{t.d(v,{A:()=>a,S:()=>s});const s="strapi_stage",a="strapi_assignee"}}]);
